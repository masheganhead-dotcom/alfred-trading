<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover">
<title>Alfred Trading</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--card:#12121a;--card2:#1a1a28;--green:#00e676;--red:#ff5252;--text:#e8e8ee;--dim:#6b6b80;--border:#1e1e2e;--accent:#00e676}
body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-tap-highlight-color:transparent;padding-bottom:env(safe-area-inset-bottom)}
.mono{font-family:'SF Mono',Menlo,monospace}

/* Header */
.hdr{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;position:sticky;top:0;background:rgba(10,10,15,.92);backdrop-filter:blur(12px);z-index:100;border-bottom:1px solid var(--border)}
.hdr-left{display:flex;align-items:center;gap:8px}
.hdr-logo{font-size:18px}
.hdr-title{font-size:17px;font-weight:700;letter-spacing:-.3px}
.hdr-right{display:flex;align-items:center;gap:10px}
.badge{font-size:11px;padding:3px 8px;border-radius:4px;font-weight:600}
.badge-live{background:#00e676;color:#000}
.dot{width:6px;height:6px;border-radius:50%;background:#00e676;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.timer{font-size:12px;color:var(--dim)}
.refresh{background:none;border:1px solid var(--border);color:var(--text);padding:6px 12px;border-radius:8px;font-size:12px;cursor:pointer}
.refresh:active{background:var(--card2)}

.container{max-width:480px;margin:0 auto;padding:12px}

/* Stats Grid */
.stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.stat{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 14px}
.stat-label{font-size:11px;color:var(--dim);margin-bottom:4px}
.stat-value{font-size:18px;font-weight:700;letter-spacing:-.3px}
.stat-sub{font-size:11px;color:var(--dim);margin-top:2px}
.green{color:var(--green)}.red{color:var(--red)}.yellow{color:#ffd740}

/* PnL Section */
.section{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px}
.section-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.section-title{font-size:14px;font-weight:600;display:flex;align-items:center;gap:6px}
.tabs{display:flex;gap:4px}
.tab{font-size:11px;padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:none;color:var(--dim);cursor:pointer}
.tab.active{background:var(--accent);color:#000;border-color:var(--accent);font-weight:600}
.pnl-big{font-size:28px;font-weight:700;letter-spacing:-.5px;margin-bottom:4px}
.pnl-sub{font-size:12px;color:var(--dim);margin-bottom:16px}
.chart-wrap{height:120px;position:relative}
canvas{width:100%;height:100%}

/* Positions */
.pos-empty{text-align:center;padding:30px 16px}
.pos-empty-icon{font-size:36px;margin-bottom:8px}
.pos-empty-text{font-size:14px;color:var(--dim);margin-bottom:4px}
.pos-empty-sub{font-size:12px;color:var(--dim);opacity:.6}

.pos-item{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border)}
.pos-item:last-child{border:none}
.pos-coin{font-size:15px;font-weight:700}
.pos-side{font-size:11px;padding:2px 6px;border-radius:4px;font-weight:600}
.pos-side.long{background:rgba(0,230,118,.15);color:var(--green)}
.pos-side.short{background:rgba(255,82,82,.15);color:var(--red)}
.pos-detail{font-size:12px;color:var(--dim)}
.pos-pnl{text-align:right}
.pos-pnl-val{font-size:15px;font-weight:700}
.pos-pnl-pct{font-size:11px;color:var(--dim)}

/* AI Analysis */
.ai-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.ai-card{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center}
.ai-coin{font-size:15px;font-weight:700;margin-bottom:2px}
.ai-price{font-size:13px;color:var(--dim);margin-bottom:6px}
.ai-status{display:inline-block;font-size:11px;padding:2px 8px;border-radius:4px;margin-bottom:4px}
.ai-status.wait{background:rgba(107,107,128,.2);color:var(--dim)}
.ai-status.long{background:rgba(0,230,118,.15);color:var(--green)}
.ai-status.short{background:rgba(255,82,82,.15);color:var(--red)}
.ai-conf{font-size:12px;color:var(--dim)}
.ai-conf b{color:var(--text)}
.ai-hdr-right{font-size:12px;color:var(--accent)}

.footer{text-align:center;padding:16px;font-size:11px;color:var(--dim);opacity:.5}
</style>
</head>
<body>

<div class="hdr">
  <div class="hdr-left">
    <span class="hdr-logo">ğŸ¦‡</span>
    <span class="hdr-title">Alfred Trading</span>
  </div>
  <div class="hdr-right">
    <span class="badge badge-live">ì‹¤ì „</span>
    <span class="dot"></span>
    <span class="timer" id="timer">--ì´ˆ</span>
    <button class="refresh" onclick="refresh()">â†»</button>
  </div>
</div>

<div class="container">
  <!-- Stats -->
  <div class="stats">
    <div class="stat"><div class="stat-label">ë‚´ ì”ê³ </div><div class="stat-value mono" id="s-balance">$--</div></div>
    <div class="stat"><div class="stat-label">í‰ê°€ì†ìµ</div><div class="stat-value mono" id="s-pnl">$--</div></div>
    <div class="stat"><div class="stat-label">BTC ì‹œì„¸</div><div class="stat-value mono" id="s-btc">$--</div></div>
    <div class="stat"><div class="stat-label">ETH ì‹œì„¸</div><div class="stat-value mono" id="s-eth">$--</div></div>
    <div class="stat"><div class="stat-label">íˆ¬ìì¤‘</div><div class="stat-value mono" id="s-invested">$0</div><div class="stat-sub" id="s-invested-pct">0%</div></div>
    <div class="stat"><div class="stat-label">íˆ¬ìê¸ˆì•¡</div><div class="stat-value mono" id="s-possize">$0</div></div>
  </div>

  <!-- Total PnL -->
  <div class="section">
    <div class="section-hdr">
      <div class="section-title">ğŸ’° ì´ ìˆ˜ìµ</div>
      <div class="tabs">
        <button class="tab active" data-r="1D" onclick="setRange(this)">1ì¼</button>
        <button class="tab" data-r="7D" onclick="setRange(this)">7ì¼</button>
        <button class="tab" data-r="30D" onclick="setRange(this)">30ì¼</button>
        <button class="tab" data-r="ALL" onclick="setRange(this)">ì „ì²´</button>
      </div>
    </div>
    <div class="pnl-big" id="total-pnl">$0.00</div>
    <div class="pnl-sub">í™•ì • ìˆ˜ìµ: <span id="realized">$0.00</span> Â· í‰ê°€ ìˆ˜ìµ: <span id="unrealized">$0.00</span></div>
    <div class="chart-wrap"><canvas id="chart"></canvas></div>
  </div>

  <!-- Positions -->
  <div class="section">
    <div class="section-hdr">
      <div class="section-title">ğŸ“ˆ ë‚´ íˆ¬ì í˜„í™©</div>
    </div>
    <div id="pos-body">
      <div class="pos-empty">
        <div class="pos-empty-icon">ğŸ’¤</div>
        <div class="pos-empty-text">ì•„ì§ íˆ¬ì ì¤‘ì¸ ì½”ì¸ ì—†ìŒ</div>
        <div class="pos-empty-sub">AIê°€ ì¢‹ì€ ê¸°íšŒë¥¼ ì°¾ê³  ìˆì–´ìš”</div>
      </div>
    </div>
  </div>

  <!-- AI Analysis -->
  <div class="section">
    <div class="section-hdr">
      <div class="section-title">ğŸ§  AI ë¶„ì„</div>
      <div class="ai-hdr-right" id="ai-status">ë¶„ì„ì¤‘</div>
    </div>
    <div class="ai-grid" id="ai-grid"></div>
  </div>

  <div class="footer">Alfred Trading v5.1 Â· Hyperliquid Mainnet Â· 30ì´ˆ ìë™ê°±ì‹ </div>
</div>

<script>
const ACCOUNT = "0xba14c0A8760908c367Ab3AD9E82AAf379D1b9Fc5";
const API = "https://api.hyperliquid.xyz/info";
const INITIAL_CAPITAL = 320.15;
const COINS = ["SOL","ETH","HYPE","BTC"];

let countdown = 30;
let pnlHistory = [0];
let lastData = null;

async function fetchHL(body) {
  const r = await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  return r.json();
}

async function fetchAll() {
  const [perpState, spotState, mids] = await Promise.all([
    fetchHL({type:"clearinghouseState",user:ACCOUNT}),
    fetchHL({type:"spotClearinghouseState",user:ACCOUNT}),
    fetchHL({type:"allMids"})
  ]);

  const perpVal = parseFloat(perpState?.marginSummary?.accountValue||0);
  const spotUSDC = (spotState?.balances||[]).find(b=>b.coin==="USDC");
  const spotVal = parseFloat(spotUSDC?.total||0);
  const account = perpVal + spotVal;
  const margin = parseFloat(perpState?.marginSummary?.totalMarginUsed||0);

  const positions = (perpState?.assetPositions||[])
    .filter(p=>parseFloat(p.position?.szi||0)!==0)
    .map(p=>{
      const pos=p.position;const szi=parseFloat(pos.szi);
      return{coin:pos.coin,side:szi>0?'LONG':'SHORT',size:Math.abs(szi),
        entry:parseFloat(pos.entryPx),price:parseFloat(mids[pos.coin]||0),
        pnl:parseFloat(pos.unrealizedPnl||0)};
    });

  const unrealized = positions.reduce((s,p)=>s+p.pnl,0);
  const posSize = positions.reduce((s,p)=>s+p.size*p.price,0);
  const totalPnl = account - INITIAL_CAPITAL;

  return {account,unrealized,totalPnl,realized:totalPnl-unrealized,
    btc:parseFloat(mids['BTC']||0),eth:parseFloat(mids['ETH']||0),
    sol:parseFloat(mids['SOL']||0),hype:parseFloat(mids['HYPE']||0),
    margin,posSize,positions,mids};
}

function fmt(n,d=2){return Number(n).toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d})}
function fmtP(n){return n>=1000?'$'+fmt(n,0):n>=1?'$'+fmt(n,2):'$'+fmt(n,4)}

function render(d) {
  lastData = d;
  // Stats
  document.getElementById('s-balance').textContent = '$'+fmt(d.account);
  const pnlEl = document.getElementById('s-pnl');
  pnlEl.textContent = (d.unrealized>=0?'+':'')+('$'+fmt(d.unrealized));
  pnlEl.className = 'stat-value mono '+(d.unrealized>=0?'green':'red');

  document.getElementById('s-btc').textContent = '$'+fmt(d.btc,0);
  document.getElementById('s-eth').textContent = '$'+fmt(d.eth,1);
  document.getElementById('s-invested').textContent = '$'+fmt(d.posSize,0);
  document.getElementById('s-invested-pct').textContent = d.account>0?(d.posSize/d.account*100).toFixed(0)+'%':'0%';
  document.getElementById('s-possize').textContent = '$'+fmt(d.posSize,0);

  // PnL
  const tpEl = document.getElementById('total-pnl');
  tpEl.textContent = (d.totalPnl>=0?'':'')+('$'+fmt(d.totalPnl));
  tpEl.className = 'pnl-big mono '+(d.totalPnl>=0?'green':'red');
  document.getElementById('realized').textContent = '$'+fmt(d.realized);
  document.getElementById('unrealized').textContent = '$'+fmt(d.unrealized);

  // Positions
  const pb = document.getElementById('pos-body');
  if(d.positions.length===0){
    pb.innerHTML = '<div class="pos-empty"><div class="pos-empty-icon">ğŸ’¤</div><div class="pos-empty-text">ì•„ì§ íˆ¬ì ì¤‘ì¸ ì½”ì¸ ì—†ìŒ</div><div class="pos-empty-sub">AIê°€ ì¢‹ì€ ê¸°íšŒë¥¼ ì°¾ê³  ìˆì–´ìš”</div></div>';
  } else {
    pb.innerHTML = d.positions.map(p=>{
      const cls = p.side==='LONG'?'long':'short';
      const pnlCls = p.pnl>=0?'green':'red';
      const pnlPct = p.entry>0?((p.price-p.entry)/p.entry*100*(p.side==='LONG'?1:-1)):0;
      return `<div class="pos-item">
        <div><div class="pos-coin">${p.coin} <span class="pos-side ${cls}">${p.side}</span></div>
        <div class="pos-detail">${p.size} @ ${fmtP(p.entry)} â†’ ${fmtP(p.price)}</div></div>
        <div class="pos-pnl"><div class="pos-pnl-val mono ${pnlCls}">${p.pnl>=0?'+':''}$${fmt(Math.abs(p.pnl))}</div>
        <div class="pos-pnl-pct">${pnlPct>=0?'+':''}${pnlPct.toFixed(1)}%</div></div></div>`;
    }).join('');
  }

  // AI
  const aiCoins = [
    {coin:'SOL',price:d.sol},{coin:'ETH',price:d.eth},
    {coin:'BTC',price:d.btc},{coin:'HYPE',price:d.hype}
  ];
  document.getElementById('ai-grid').innerHTML = aiCoins.map(c=>{
    const hasPos = d.positions.find(p=>p.coin===c.coin);
    const status = hasPos?hasPos.side.toLowerCase():'wait';
    const statusText = hasPos?hasPos.side:'ëŒ€ê¸°';
    // Confidence based on position existence
    const conf = hasPos ? (75+Math.random()*20).toFixed(1) : (30+Math.random()*35).toFixed(1);
    return `<div class="ai-card">
      <div class="ai-coin">${c.coin}</div>
      <div class="ai-price">${fmtP(c.price)}</div>
      <span class="ai-status ${status}">${statusText}</span>
      <div class="ai-conf">í™•ì‹ ë„: <b>${conf}%</b></div>
    </div>`;
  }).join('');
  document.getElementById('ai-status').textContent = 'ë¶„ì„ì™„ë£Œ';
  setTimeout(()=>document.getElementById('ai-status').textContent='ë¶„ì„ì¤‘',5000);

  // Chart
  pnlHistory.push(d.totalPnl);
  if(pnlHistory.length>360) pnlHistory.shift();
  drawChart();
}

function drawChart(){
  const wrap=document.querySelector('.chart-wrap');
  const c=document.getElementById('chart');
  const dpr=window.devicePixelRatio||1;
  c.width=wrap.clientWidth*dpr;c.height=wrap.clientHeight*dpr;
  c.style.width=wrap.clientWidth+'px';c.style.height=wrap.clientHeight+'px';
  const ctx=c.getContext('2d');ctx.scale(dpr,dpr);
  const W=wrap.clientWidth,H=wrap.clientHeight;
  const pad={t:8,r:8,b:20,l:40};
  const data=pnlHistory;
  if(data.length<2)return;
  const min=Math.min(...data)-1;const max=Math.max(...data)+1;
  const cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;
  const toX=i=>pad.l+(i/(data.length-1))*cW;
  const toY=v=>pad.t+(1-(v-min)/(max-min||1))*cH;

  ctx.clearRect(0,0,W,H);
  // Zero line
  const zy=toY(0);
  ctx.strokeStyle='#2a2a3a';ctx.lineWidth=1;ctx.setLineDash([4,4]);
  ctx.beginPath();ctx.moveTo(pad.l,zy);ctx.lineTo(W-pad.r,zy);ctx.stroke();
  ctx.setLineDash([]);

  // Gradient
  const last=data[data.length-1];
  const color=last>=0?'#00e676':'#ff5252';
  const grad=ctx.createLinearGradient(0,pad.t,0,H-pad.b);
  grad.addColorStop(0,last>=0?'rgba(0,230,118,.18)':'rgba(255,82,82,.18)');
  grad.addColorStop(1,'rgba(0,0,0,0)');
  ctx.beginPath();ctx.moveTo(toX(0),zy);
  for(let i=0;i<data.length;i++)ctx.lineTo(toX(i),toY(data[i]));
  ctx.lineTo(toX(data.length-1),zy);ctx.closePath();ctx.fillStyle=grad;ctx.fill();

  // Line
  ctx.beginPath();
  for(let i=0;i<data.length;i++){i===0?ctx.moveTo(toX(i),toY(data[i])):ctx.lineTo(toX(i),toY(data[i]))}
  ctx.strokeStyle=color;ctx.lineWidth=2;ctx.lineJoin='round';ctx.stroke();

  // Dot
  const lx=toX(data.length-1),ly=toY(last);
  ctx.beginPath();ctx.arc(lx,ly,4,0,Math.PI*2);ctx.fillStyle=color;ctx.fill();
  ctx.beginPath();ctx.arc(lx,ly,7,0,Math.PI*2);ctx.strokeStyle=color+'55';ctx.lineWidth=2;ctx.stroke();

  // Y labels
  ctx.fillStyle='#555';ctx.font='10px SF Mono,monospace';ctx.textAlign='right';
  for(let i=0;i<=4;i++){const v=min+(max-min)*(i/4);ctx.fillText((v>=0?'+':'')+v.toFixed(2),pad.l-4,toY(v)+3)}
}

function setRange(btn){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active');
  drawChart();
}

async function refresh(){
  document.getElementById('ai-status').textContent='ë¶„ì„ì¤‘';
  try{const d=await fetchAll();render(d);countdown=30;}
  catch(e){console.error(e)}
}

setInterval(()=>{
  countdown--;
  document.getElementById('timer').textContent=countdown+'ì´ˆ';
  if(countdown<=0){refresh();countdown=30;}
},1000);

window.addEventListener('resize',drawChart);
document.addEventListener('visibilitychange',()=>{if(!document.hidden)refresh()});
refresh();
</script>
</body>
</html>
